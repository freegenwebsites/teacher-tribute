<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Retiring Teacher Tribute Board</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css">
  <style>
    body { font-family: 'Quicksand', 'Indie Flower', cursive, sans-serif; background: linear-gradient(110deg, #fde7fb 0%, #e6e8ff 100%);}
    .tribute-card {
      transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
      position: relative;
      background: #fff9fe;
    }
    .tribute-card:hover {
      transform: translateY(-6px) scale(1.045) rotate(-1.5deg);
      box-shadow: 0 8px 28px rgba(180, 138, 255, 0.18), 0 1.5px 8px rgba(122, 122, 216, 0.17);
      z-index: 10;
    }
    .cute-title {
      font-family: 'Indie Flower', cursive;
      color: #b366d1;
      letter-spacing: 2px;
      font-size: 2.15rem;
      text-shadow: 0 2px 7px #fed6f5a5;
    }
    .cute-quote {font-family: 'Indie Flower', cursive;color: #6d4fa8;font-size: 1.08rem;opacity: 0.85;text-align: center;}
    .floating-heart {
      position: absolute;
      font-size: 1.2rem;
      opacity: 0.16;
      pointer-events: none;
      animation: floatHeart 8s linear infinite;
    }
    @keyframes floatHeart {
      0% {transform: translateY(40px) scale(1.3);}
      100% {transform: translateY(-210px) scale(1);}
    }
    /* Modal (fullscreen image gallery) styles */
    .gallery-modal-bg {position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(52,28,75,0.58);z-index:50;display:none;align-items:center;justify-content:center;}
    .gallery-modal-bg.active {display:flex;}
    .gallery-img-viewer {max-width:91vw;max-height:82vh;box-shadow:0 4px 30px 0 rgba(71,40,116,.27);}
    .gallery-modal-controls {position:absolute;top:50%;width:100vw;display:flex;justify-content:space-between;z-index:60;pointer-events:none;}
    .gallery-modal-controls button {pointer-events:auto;}

    /* Collage Gallery grid inside card */
    .photo-collage {display:grid;gap:6px;}
    .collage-1 {grid-template-columns:1fr;}
    .collage-2 {grid-template-columns:repeat(2,1fr);}
    .collage-3, .collage-4 {grid-template-columns:repeat(2,1fr);}
    .collage-3 img:nth-child(1) {grid-column:1/3;}
    .photo-collage img {object-fit:cover;width:100%;height:96px;border-radius:0.7em;transition:box-shadow .18s;}
    .photo-collage img:hover {box-shadow: 0 4px 16px rgba(235,140,255,0.24);}
    .collage-1 img {height:180px;}
    .collage-2 img {height:146px;}
    .collage-4 img {height:89px;}

    .custom-scroll::-webkit-scrollbar { width: 7px;}
    .custom-scroll::-webkit-scrollbar-thumb { background: #d2a9f6; border-radius: 10px;}
    .custom-scroll::-webkit-scrollbar-track { background: #f5efff;}
    .edit-input, .edit-textarea { outline: 2px solid #b991ed; background: #fbf2ff; }
    .edit-actions button {margin-right:0.3em;}
  </style>
</head>
<body class="min-h-screen pb-14 select-none">
  <!-- Floating hearts for cuteness -->
  <span class="floating-heart left-10 top-20" style="animation-delay:0s; color:#f890b4;"><i class="fa-solid fa-heart"></i></span>
  <span class="floating-heart left-1/2 top-7" style="animation-delay:1.3s; color:#dcb8ff;"><i class="fa-solid fa-heart"></i></span>
  <span class="floating-heart right-8 top-24" style="animation-delay:0.7s; color:#fcddec;"><i class="fa-solid fa-heart"></i></span>
  <span class="floating-heart left-1/3 top-32" style="animation-delay:2.8s; color:#fcb6c0;"><i class="fa-solid fa-heart"></i></span>
  <!-- Title -->
  <div class="text-center mt-8">
    <h1 class="cute-title mb-2">üå∑ Happy Retirement, Teacher! üåà</h1>
    <p class="cute-quote">
      ‚ÄúA good teacher is like a candle ‚Äì it consumes itself to light the way for others.‚Äù<br>
      <span class="text-pink-400 font-semibold">Leave your heartfelt words & pictures below!</span>
    </p>
  </div>
  <!-- Board Container -->
  <div class="w-full max-w-5xl mx-auto mt-10 px-3">
    <!-- Add Message Form -->
    <form id="tributeForm" class="mb-9 sticky-top p-4 flex flex-wrap items-center justify-between rounded-2xl border border-purple-100 shadow-lg bg-white" autocomplete="off">
      <div class="flex flex-col w-full sm:w-1/4 mb-2 sm:mb-0 sm:pr-2">
        <label for="fromName" class="text-purple-500 font-semibold mb-1">Your Name</label>
        <input id="fromName" name="fromName" type="text" class="rounded-xl border border-purple-200 px-3 py-2 focus:ring-2 focus:ring-pink-200 focus:outline-none" maxlength="32" required autocomplete="off" placeholder="Jamie"></div>
      <div class="flex flex-col w-full sm:w-1/2 mb-2 sm:mb-0 sm:px-2">
        <label for="message" class="text-purple-500 font-semibold mb-1">Message</label>
        <textarea id="message" name="message" rows="2" class="rounded-xl border border-purple-200 px-3 py-2 focus:ring-2 focus:ring-pink-200 focus:outline-none" maxlength="230" required placeholder="Your message..."></textarea>
      </div>
      <div class="flex flex-col w-full sm:w-1/6 sm:px-2 mb-2 sm:mb-0">
        <label for="photo" class="text-purple-500 font-semibold mb-1">Photo(s)<br><span class="font-normal text-xs text-gray-300">(max 3)</span></label>
        <input id="photo" name="photo" multiple type="file" accept="image/*" class="border rounded-xl py-2 px-1 text-xs bg-purple-50">
      </div>
      <div class="w-full sm:w-auto flex items-end justify-start sm:justify-end mt-2 sm:mt-0">
        <button type="submit" class="bg-gradient-to-r from-pink-300 to-violet-400 hover:from-rose-200 hover:to-violet-700 font-bold py-2 px-6 text-white rounded-xl focus:outline-none transition-transform transform active:scale-95 shadow">
          <i class="fa-solid fa-paper-plane mr-1"></i> Share
        </button>
      </div>
    </form>
    <!-- Messages Board -->
    <div id="tributesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-7 custom-scroll transition-all">
      <!-- Tributes inserted here -->
    </div>
    <div id="emptyState" class="text-center text-purple-300 italic mt-10 text-lg hidden">
      <i class="fa-solid fa-star fa-bounce mr-2"></i>No messages yet. Be the first to post your tribute!
    </div>
    <div id="galleryModal" class="gallery-modal-bg">
      <div class="z-50 relative bg-transparent overflow-visible">
        <button type="button" class="absolute -top-11 right-2 text-2xl text-white bg-pink-600 hover:bg-pink-400 focus:outline-none px-3 py-1 rounded-full z-60" id="closeGalleryBtn" title="Close"><i class="fa-solid fa-xmark"></i></button>
        <img src="" alt="Gallery Photo" id="galleryImage" class="gallery-img-viewer rounded-3xl border-2 border-white shadow-lg transition-all duration-300" draggable="false">
        <div class="gallery-modal-controls">
          <button type="button" class="text-3xl p-3 bg-white bg-opacity-30 hover:bg-opacity-80 rounded-l-full rounded-r-full ml-2" id="prevPhoto" title="Prev"><i class="fa-solid fa-chevron-left"></i></button>
          <button type="button" class="text-3xl p-3 bg-white bg-opacity-30 hover:bg-opacity-80 rounded-l-full rounded-r-full mr-2" id="nextPhoto" title="Next"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
      </div>
    </div>
  </div>
  <footer class="w-full text-center py-7 mt-8 text-gray-400 text-base">
    <i class="fa-solid fa-cake-candles text-pink-300"></i>
    <span>Made with üíù for an unforgettable teacher's new adventure.</span>
  </footer>
<script>
const starterTributes = [
  {
    from: "Zoe",
    msg: "Thank you for being such a patient and inspiring teacher. Happy retirement!",
    date: "May 17, 2024",
    photos: [
      "https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=facearea&w=320&h=220&facepad=1"
    ]
  },
  {
    from: "Ming",
    msg: "I'll always remember your fun lessons and kind smile. You made school a happy place!",
    date: "May 18, 2024",
    photos: []
  },
  {
    from: "Alicia",
    msg: "Wishing you endless days of gardening and naps. You‚Äôve earned it!",
    date: "May 18, 2024",
    photos: [
      "https://images.unsplash.com/photo-1444065381814-865dc9da92c0?auto=format&fit=facearea&w=320&h=220&facepad=2",
      "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=facearea&w=320&h=220&facepad=1"
    ]
  }
];

function formatNow() {
  const d = new Date();
  return d.toLocaleDateString("en-US", { month: 'short', day: 'numeric', year: 'numeric' });
}

function loadTributes() {
  const ls = window.localStorage.getItem('retireTributesV2');
  if(ls) {try {return JSON.parse(ls);} catch{ return [];} }
  return [...starterTributes];
}
function saveTributes(arr) {
  window.localStorage.setItem('retireTributesV2', JSON.stringify(arr));
}
// For gallery modal
let galleryPhotoSet = [], galleryPhotoIdx = 0;

function renderPhotoCollage(photos, tribIdx) {
  if(!photos || !photos.length) return '';
  let collageClass="collage-"+photos.length;
  let imgs = '';
  for(let i=0;i<photos.length;i++) {
    imgs += `<img src="${photos[i]}" class="gallery-thumb" data-tribidx="${tribIdx}" data-photoidx="${i}" alt="Tribute Photo ${i+1}" loading="lazy">`;
  }
  return `<div class="photo-collage ${collageClass} mb-2 cursor-pointer">${imgs}</div>`;
}

function renderTributeCard(tribute, idx) {
  // If not editing...
  let imageMarkup = "";
  if(tribute.photos && tribute.photos.length>0) {
    imageMarkup = renderPhotoCollage(tribute.photos, idx);
  } else {
    imageMarkup = `<div class="w-16 h-16 flex items-center justify-center text-pink-400 rounded-full bg-pink-50 border-2 border-pink-100 mb-2 mx-auto shadow-sm text-3xl">
      <i class="fa-solid fa-flower"></i>
    </div>`;
  }
  const icons=['fa-flower','fa-apple-whole','fa-star','fa-heart'];
  return `
    <div class="tribute-card flex flex-col items-center px-5 pt-7 pb-7 rounded-2xl shadow-md min-h-[290px] relative group">
      <div class="w-full flex flex-row-reverse gap-2 absolute -top-2 right-3 opacity-60 group-hover:opacity-95 transition-opacity z-10">
        <button class="edit-btn text-indigo-500 hover:text-indigo-900 px-2 py-1 focus:outline-none" title="Edit"><i class="fa-solid fa-pen-to-square"></i></button>
        <button class="remove-btn text-pink-500 hover:text-pink-900 px-2 py-1 focus:outline-none" title="Delete"><i class="fa-solid fa-trash"></i></button>
      </div>
      ${imageMarkup}
      <div class="text-purple-500 font-bold mb-1">${tribute.from || "Anonymous"}</div>
      <div class="text-gray-700 mb-3 text-center whitespace-pre-line" style="font-family:'Indie Flower',cursive;font-size:1.13rem;">${tribute.msg}</div>
      <div class="text-xs text-pink-400 absolute bottom-3 left-1/2 transform -translate-x-1/2 flex items-center gap-1">
        <i class="fa-solid ${icons[idx%icons.length]}"></i>
        <span>${tribute.date||""}</span>
      </div>
    </div>
  `;
}

function renderAllTributes(){
  const tributes = loadTributes();
  const grid = document.getElementById('tributesGrid');
  grid.innerHTML = "";
  if(!tributes.length) {
    document.getElementById('emptyState').classList.remove('hidden');
    return;
  } else {
    document.getElementById('emptyState').classList.add('hidden');
  }
  tributes.forEach((trb, idx) => {
    grid.innerHTML += renderTributeCard(trb, idx);
  });

  // Attach hover/click for collage images (gallery modal)
  document.querySelectorAll('.gallery-thumb').forEach(img=>{
    img.addEventListener('click', e=>{
      e.stopPropagation();
      let tribIdx = parseInt(img.getAttribute('data-tribidx'));
      let pIdx = parseInt(img.getAttribute('data-photoidx'));
      let tribs = loadTributes();
      galleryPhotoSet = (tribs[tribIdx]?.photos)||[];
      galleryPhotoIdx = pIdx;
      openGalleryModal();
    });
  });
  // Attach edit/remove events
  grid.querySelectorAll('.tribute-card').forEach((card,idx)=>{
    card.querySelector('.remove-btn').onclick = function(e){
      if(confirm("Remove this tribute? This cannot be undone.")){
        const tribs = loadTributes();
        tribs.splice(idx,1);
        saveTributes(tribs);
        renderAllTributes();
      }
    }
    card.querySelector('.edit-btn').onclick = function(e){
      startEditCard(idx,card);
    }
  });
}

document.getElementById('tributeForm').onsubmit = async function(e) {
  e.preventDefault();
  const from = document.getElementById('fromName').value.trim() || "Anonymous";
  const msg = document.getElementById('message').value.trim();
  const date = formatNow();
  const fileInput = document.getElementById('photo');
  let photos = [];
  if(fileInput.files.length) {
    for(let i=0; i<fileInput.files.length && photos.length<3; i++) {
      const file = fileInput.files[i];
      if(file.type.startsWith('image/') && file.size<3.3e6) {
        // files from input in browser: Use objectURL, later could be replaced by server-side URLs
        photos.push(URL.createObjectURL(file));
      }
    }
  }
  let tributes = loadTributes();
  tributes.unshift({from, msg, date, photos});
  saveTributes(tributes);
  renderAllTributes();
  document.getElementById('tributeForm').reset();
  // Remove past ObjectURLs to avoid memory leak
  setTimeout(() => { photos.forEach(ph=>{ if(ph.startsWith('blob:')) URL.revokeObjectURL(ph); });}, 7500);
};
// --- Edit functionality --
function startEditCard(idx,cardElem) {
  let tribs = loadTributes();
  let t = tribs[idx];
  // Build edit form inside the card
  cardElem.innerHTML = `<form class='edit-tribute-form w-full h-full flex flex-col items-center justify-between p-1' autocomplete="off">
    <input type="text" class="edit-input font-bold px-2 py-1 rounded-xl border border-purple-300 w-4/5 my-2 text-purple-500 text-lg text-center" maxlength="32" value="${escapeHtml(t.from)}">
    <textarea class="edit-textarea px-2 py-1 rounded-xl border border-purple-300 w-4/5 my-1 mb-2 text-gray-700 text-center resize-none" maxlength="230" rows="3">${escapeHtml(t.msg)}</textarea>
    <div class='flex justify-center flex-wrap gap-2 mb-1'>
      ${t.photos&&t.photos.map((ph,i)=>
        `<span class="relative rounded-lg">
          <img src="${ph}" class="inline-block w-16 h-16 object-cover rounded-lg border border-purple-200 shadow-md">
          <button title="Remove" type="button" class="remove-img absolute -top-2 -right-2 text-sm text-center w-6 h-6 leading-5 bg-white border border-pink-400 text-pink-500 rounded-full hover:bg-pink-500 hover:text-white shadow-sm" data-phidx="${i}"><i class="fa fa-times"></i></button>
        </span>`).join("")}
    </div>
    <label class="w-full text-purple-400 font-medium text-xs mb-1"><i class="fa fa-image"></i> Add more photo
      <input type="file" accept="image/*" class="edit-photo-uploader ml-1 mb-1" style="display:inline;" multiple>
    </label>
    <div class="edit-actions mt-2 w-full flex justify-center gap-2">
      <button type="submit" class="bg-violet-200 hover:bg-violet-300 text-indigo-700 font-semibold py-1 px-3 rounded-lg">Save</button>
      <button type="button" class="bg-pink-200 hover:bg-pink-300 text-pink-700 font-semibold py-1 px-3 rounded-lg cancel-edit-btn">Cancel</button>
    </div>
  </form>`;
  // Remove image button
  cardElem.querySelectorAll('.remove-img').forEach(btn=>{
    btn.onclick = function(){
      let phidx = parseInt(btn.getAttribute('data-phidx'));
      let formImgs = Array.from(cardElem.querySelectorAll(".remove-img"));
      let spnImg = formImgs[phidx]?.parentElement;
      if(spnImg) spnImg.remove();
      t.photos.splice(phidx,1);
    }
  });
  // Add photo (up to 3)
  cardElem.querySelector('.edit-photo-uploader').onchange = function(e){
    let files = Array.from(e.target.files);
    if(files.some(f=>t.photos.length<3 && f.type.startsWith('image/') && f.size<3.3e6)){
      files.slice(0,3-t.photos.length).forEach(f=>{
        let url = URL.createObjectURL(f);
        t.photos.push(url);
      });
      startEditCard(idx,cardElem); // rerender
    }
  }
  // Cancel btn
  cardElem.querySelector('.cancel-edit-btn').onclick = function(){ renderAllTributes(); }
  // Save btn
  cardElem.querySelector('.edit-tribute-form').onsubmit = function(e){
    e.preventDefault();
    t.from = cardElem.querySelector('.edit-input').value.trim().slice(0,32)||"";
    t.msg = cardElem.querySelector('.edit-textarea').value.trim().slice(0,230)||"";
    saveTributes(tribs);
    renderAllTributes();
  }
}
function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, s=>{
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[s]
  })
}

// --- Gallery Modal Logic ---
function openGalleryModal() {
  const modal = document.getElementById('galleryModal');
  updateGalleryView();
  modal.classList.add('active');
  document.body.style.overflow='hidden';
}
function closeGalleryModal() {
  const modal = document.getElementById('galleryModal');
  modal.classList.remove('active');
  document.body.style.overflow='';
}
// update main image in gallery modal
function updateGalleryView() {
  const img = document.getElementById('galleryImage');
  if(galleryPhotoSet && galleryPhotoSet.length){
    img.src = galleryPhotoSet[galleryPhotoIdx];
    img.alt = "Gallery Photo";
    img.setAttribute('draggable','false');
  }
}
document.getElementById('closeGalleryBtn').onclick=closeGalleryModal;
document.getElementById('prevPhoto').onclick=function(e){
  if(galleryPhotoSet.length){
    galleryPhotoIdx=(galleryPhotoSet.length+galleryPhotoIdx-1)%galleryPhotoSet.length;
    updateGalleryView();
  }
}
document.getElementById('nextPhoto').onclick=function(e){
  if(galleryPhotoSet.length){
    galleryPhotoIdx=(galleryPhotoIdx+1)%galleryPhotoSet.length;
    updateGalleryView();
  }
}
// Close modal on clicking outside or pressing Esc
document.getElementById('galleryModal').onclick=function(e) {
  if(e.target===this) closeGalleryModal();
}
document.addEventListener('keydown', function(e){
  if(document.getElementById('galleryModal').classList.contains('active')){
    if(e.key==='Escape'){ closeGalleryModal(); }
    if(e.key==='ArrowRight'){document.getElementById('nextPhoto').click();}
    if(e.key==='ArrowLeft'){document.getElementById('prevPhoto').click();}
  }
});
// -- Mounting animation & loading
document.addEventListener("DOMContentLoaded", function() {
  renderAllTributes();
  setTimeout(()=>{
    document.getElementById('tributesGrid').classList.add('scale-105','transition-transform','duration-700','ease-out');
    setTimeout(()=>{document.getElementById('tributesGrid').classList.remove('scale-105');}, 550);
  }, 300);
});

window.onbeforeunload = () => {
  let tribs = loadTributes();
  tribs.forEach(t=>{
    t.photos&&t.photos.forEach(ph=>{
      if(ph&&ph.startsWith('blob:')){ try{ URL.revokeObjectURL(ph);}catch{} }
    });
  });
}
</script>
</body>
</html>


