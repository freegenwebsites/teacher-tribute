<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Retiring Teacher Tribute Board</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" />
  <style>
    body {
      font-family: 'Quicksand', 'Indie Flower', cursive, sans-serif;
      background: linear-gradient(110deg, #fde7fb 0%, #e6e8ff 100%);
      min-height: 100vh;
    }
    .cute-title {
      font-family: 'Indie Flower', cursive;
      color: #b366d1;
      letter-spacing: 2px;
      font-size: 2.15rem;
      text-shadow: 0 2px 7px #fed6f5a5;
    }
    .cute-quote {
      font-family: 'Indie Flower', cursive;
      color: #6d4fa8;
      font-size: 1.08rem;
      opacity: 0.85;
      text-align: center;
    }
    .fan-stack {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      margin: 0 auto 14px auto;
      position: relative;
      min-height: 120px;
    }
    .fan-img {
      width: 86px;
      height: 86px;
      object-fit: cover;
      border-radius: 1.1rem;
      box-shadow: 0 6px 22px rgba(220, 176, 253, 0.26);
      transform-origin: 50% 80%;
      position: absolute;
      cursor: pointer;
      transition: 
        box-shadow 0.2s cubic-bezier(0.34, 1.3, 0.47, 1.13), 
        transform 0.33s cubic-bezier(.38,1.49,.67,.94), 
        z-index 0.2s;
      z-index: 1;
      background: #fffbfe;
      border: 2.5px solid #ede1fa;
    }
    .fan-img.expanded {
      z-index: 10 !important;
      box-shadow: 0 12px 42px 0 rgba(220,176,253,0.28);
      transform: scale(1.22) translateY(-10px) !important;
    }
    .tribute-card {
      transition: box-shadow 0.2s, transform .20s cubic-bezier(0.18,0.95,0.61,0.97);
      position: relative;
      background: #fff9fe;
      overflow: visible;
    }
    .tribute-card.animate-in {
      animation: entryPopIn .7s cubic-bezier(.68,1.6,.5,.82);
    }
    @keyframes entryPopIn {
      0% {transform: scale(.65) translateY(80px); opacity: 0.2;}
      80% {transform: scale(1.04); opacity: 1;}
      100% {transform: scale(1);}
    }
    @media (hover: none) and (pointer: coarse) {
      .tribute-card {
        /* on mobile, animate cards when in view (see js) */
      }
    }
    /* Hide input number arrows in modern browsers */
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0;}
    input[type="number"] { -moz-appearance: textfield; }
    .floating-heart {
      position: absolute;
      font-size: 1.3rem;
      opacity: 0.18;
      pointer-events: none;
      animation: floatHeart 8s linear infinite;
    }
    @keyframes floatHeart {
      0% {transform: translateY(40px) scale(1.2);}
      100% {transform: translateY(-210px) scale(1);}
    }
    .custom-scroll::-webkit-scrollbar { width: 7px;}
    .custom-scroll::-webkit-scrollbar-thumb { background: #d2a9f6; border-radius: 10px;}
    .custom-scroll::-webkit-scrollbar-track { background: #f5efff;}
    /* expand anim for fan on tap or scroll-in */
    .fanImgAnim {
      animation: fanPop .74s cubic-bezier(.65,1.7,.5,.8);
    }
    @keyframes fanPop {
      0% { transform: scale(.74) rotate(0deg);}
      70% { transform: scale(1.17) rotate(2deg);}
      100% { transform: scale(1) rotate(0deg);}
    }
  </style>
</head>
<body class="pb-14">
  <!-- Decorations -->
  <span class="floating-heart left-10 top-20" style="animation-delay:0s; color:#f890b4;"><i class="fa-solid fa-heart"></i></span>
  <span class="floating-heart left-1/2 top-7" style="animation-delay:1.3s; color:#dcb8ff;"><i class="fa-solid fa-heart"></i></span>
  <span class="floating-heart right-8 top-28" style="animation-delay:0.7s; color:#fcddec;"><i class="fa-solid fa-heart"></i></span>
  <span class="floating-heart left-1/3 top-32" style="animation-delay:2.8s; color:#fcb6c0;"><i class="fa-solid fa-heart"></i></span>
  <!-- Title/Intro -->
  <div class="text-center mt-8">
    <h1 class="cute-title mb-2">üå∑ Happy Retirement, Teacher! üåà</h1>
    <p class="cute-quote">
      ‚ÄúA good teacher is like a candle ‚Äì it consumes itself to light the way for others.‚Äù<br>
      <span class="text-pink-400 font-semibold">Leave your heartfelt words & pictures below!</span>
    </p>
  </div>
  <!-- Board Main -->
  <div class="w-full max-w-5xl mx-auto mt-10 px-3">
    <!-- Add Message Form -->
    <form id="tributeForm" class="mb-9 p-4 flex flex-wrap items-center justify-between rounded-2xl border border-purple-100 shadow-lg bg-white" autocomplete="off">
      <div class="flex flex-col w-full sm:w-1/4 mb-2 sm:mb-0 sm:pr-2">
        <label for="fromName" class="text-purple-500 font-semibold mb-1">Your Name</label>
        <input id="fromName" name="fromName" type="text" class="rounded-xl border border-purple-200 px-3 py-2 focus:ring-2 focus:ring-pink-200 focus:outline-none" maxlength="32" required autocomplete="off" placeholder="Jamie"/>
      </div>
      <div class="flex flex-col w-full sm:w-1/2 mb-2 sm:mb-0 sm:px-2">
        <label for="message" class="text-purple-500 font-semibold mb-1">Message</label>
        <textarea id="message" name="message" rows="2" class="rounded-xl border border-purple-200 px-3 py-2 focus:ring-2 focus:ring-pink-200 focus:outline-none" maxlength="230" required placeholder="Your message..."></textarea>
      </div>
      <div class="flex flex-col w-full sm:w-1/6 sm:px-2 mb-2 sm:mb-0">
        <label for="photo" class="text-purple-500 font-semibold mb-1">Photo(s)<br><span class="font-normal text-xs text-gray-300">(max 4)</span></label>
        <input id="photo" name="photo" multiple type="file" accept="image/*" class="border rounded-xl py-2 px-1 text-xs bg-purple-50"/>
      </div>
      <div class="w-full sm:w-auto flex items-end justify-start sm:justify-end mt-2 sm:mt-0">
        <button type="submit" class="bg-gradient-to-r from-pink-300 to-violet-400 hover:from-rose-200 hover:to-violet-700 font-bold py-2 px-6 text-white rounded-xl focus:outline-none transition-transform transform active:scale-95 shadow">
          <i class="fa-solid fa-paper-plane mr-1"></i> Share
        </button>
      </div>
    </form>
    <!-- Tribute Grid -->
    <div id="tributesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-7 custom-scroll transition-all"></div>
    <div id="emptyState" class="text-center text-purple-300 italic mt-10 text-lg hidden">
      <i class="fa-solid fa-star fa-bounce mr-2"></i>No messages yet. Be the first to post your tribute!
    </div>
    <!-- Modal for viewing fan image -->
    <div id="fanModal" class="fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center hidden">
      <div class="relative">
        <img id="fanModalImg" src="" alt="Tribute Image" class="rounded-2xl shadow-lg max-h-[74vh] max-w-[95vw] border-2 border-white" />
        <button id="fanModalClose" class="absolute -top-8 right-2 text-white text-2xl bg-pink-700 px-2 py-0.5 rounded-full hover:bg-pink-400 shadow"><i class="fa-solid fa-xmark"></i></button>
      </div>
    </div>
  </div>
  <footer class="w-full text-center py-7 mt-8 text-gray-400 text-base">
    <i class="fa-solid fa-cake-candles text-pink-300"></i>
    <span>Made with üíù for an unforgettable teacher's new adventure.</span>
  </footer>
<script>
// Starter tributes for demo
const starterTributes = [
  {
    from: "Zoe",
    msg: "Thank you for being such a patient and inspiring teacher. Happy retirement!",
    date: "May 17, 2024",
    photos: [
      "https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=facearea&w=320&h=220&facepad=1"
    ]
  },
  {
    from: "Ming",
    msg: "I'll always remember your fun lessons and kind smile. You made school a happy place!",
    date: "May 18, 2024",
    photos: []
  },
  {
    from: "Alicia",
    msg: "Wishing you endless days of gardening and naps. You‚Äôve earned it!",
    date: "May 18, 2024",
    photos: [
      "https://images.unsplash.com/photo-1444065381814-865dc9da92c0?auto=format&fit=facearea&w=320&h=220&facepad=2",
      "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=facearea&w=320&h=220&facepad=1"
    ]
  }
];
// Util
function formatNow() {
  const d = new Date();
  return d.toLocaleDateString("en-US", { month: 'short', day: 'numeric', year: 'numeric' });
}
function loadTributes() {
  const ls = window.localStorage.getItem('retireTributesFanV3');
  if(ls) {try {return JSON.parse(ls);} catch{ return [];} }
  return [...starterTributes];
}
function saveTributes(arr) {
  window.localStorage.setItem('retireTributesFanV3', JSON.stringify(arr));
}
function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, s=>{
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[s]
  })
}
// Fan-stacked image markup
function renderFanStack(photos, tribIdx) {
  if(!photos||!photos.length) return '';
  // Fan angles for up to 4
  let maxAng = 36, spread = (photos.length>1) ? (maxAng/(photos.length-1)) : 0;
  let baseAng = -0.5 * (maxAng);
  let imgMarkup = '';
  let leftMost = (photos.length-1)*42/2;
  for(let i=0;i<photos.length;i++) {
    let ang = baseAng + i*spread;
    let l = (i*42)-(leftMost);
    imgMarkup += `<img src="${photos[i]}" 
      class="fan-img" 
      data-tribidx="${tribIdx}" 
      data-photoidx="${i}" 
      alt="Tribute Photo ${i+1}" 
      style="transform: rotate(${ang}deg) translateX(${l}px);" 
      loading="lazy"/>`;
  }
  return `<div class="fan-stack w-full mb-2 min-h-[100px]">${imgMarkup}</div>`;
}
// Tribute card markup
function renderTributeCard(tribute, idx) {
  let imageMarkup = "";
  if(tribute.photos && tribute.photos.length>0) {
    imageMarkup = renderFanStack(tribute.photos, idx);
  } else {
    imageMarkup = `<div class="w-16 h-16 flex items-center justify-center text-pink-400 rounded-full bg-pink-50 border-2 border-pink-100 mb-2 mx-auto shadow-sm text-3xl">
      <i class="fa-solid fa-flower"></i>
    </div>`;
  }
  const icons=['fa-flower','fa-apple-whole','fa-star','fa-heart'];
  return `
    <div class="tribute-card flex flex-col items-center px-5 pt-7 pb-8 rounded-2xl shadow-md min-h-[290px] relative group bg-white bg-opacity-90">
      <div class="w-full flex flex-row-reverse gap-2 absolute -top-2 right-3 opacity-60 group-hover:opacity-95 transition-opacity z-10">
        <button class="edit-btn text-indigo-500 hover:text-indigo-900 px-2 py-1 focus:outline-none" title="Edit"><i class="fa-solid fa-pen-to-square"></i></button>
        <button class="remove-btn text-pink-500 hover:text-pink-900 px-2 py-1 focus:outline-none" title="Delete"><i class="fa-solid fa-trash"></i></button>
      </div>
      ${imageMarkup}
      <div class="text-purple-500 font-bold mb-1">${escapeHtml(tribute.from || "Anonymous")}</div>
      <div class="text-gray-700 mb-3 text-center whitespace-pre-line" style="font-family:'Indie Flower',cursive;font-size:1.11rem;">${escapeHtml(tribute.msg)}</div>
      <div class="text-xs text-pink-400 absolute bottom-3 left-1/2 transform -translate-x-1/2 flex items-center gap-1">
        <i class="fa-solid ${icons[idx%icons.length]}"></i>
        <span>${tribute.date||""}</span>
      </div>
    </div>
  `;
}
// --- RENDER ---
function renderAllTributes(scrollToTop=true){
  const tributes = loadTributes();
  const grid = document.getElementById('tributesGrid');
  grid.innerHTML = "";
  if(!tributes.length) {
    document.getElementById('emptyState').classList.remove('hidden');
    return;
  } else {
    document.getElementById('emptyState').classList.add('hidden');
  }
  tributes.forEach((trb, idx) => {
    let div = document.createElement('div');
    div.innerHTML = renderTributeCard(trb, idx);
    const card = div.firstElementChild;
    card.style.opacity="0";
    // Animate in when mounting
    setTimeout(()=>{card.style.opacity="1"; card.classList.add('animate-in');}, 60+idx*75);
    grid.appendChild(card);
    // Remove/Delete handlers
    card.querySelector('.remove-btn').onclick = function(e){
      if(confirm("Remove this tribute? This cannot be undone.")){
        const tribs = loadTributes();
        tribs.splice(idx,1);
        saveTributes(tribs);
        renderAllTributes();
      }
    }
    card.querySelector('.edit-btn').onclick = function(e){
      startEditCard(idx,card);
    }
  });
  setTimeout(()=>attachFanImgEvents(), 200);
  if(scrollToTop) window.scrollTo({top: 0, behavior: "smooth"});
}
// --- FORM SUBMIT ---
document.getElementById('tributeForm').onsubmit = async function(e) {
  e.preventDefault();
  const from = document.getElementById('fromName').value.trim() || "Anonymous";
  const msg = document.getElementById('message').value.trim();
  const date = formatNow();
  const fileInput = document.getElementById('photo');
  let photos = [];
  if(fileInput.files.length) {
    for(let i=0; i<fileInput.files.length && photos.length<4; i++) {
      const file = fileInput.files[i];
      if(file.type.startsWith('image/') && file.size<4e6) {
        // files from input in browser: Use objectURL (local, no upload)
        photos.push(URL.createObjectURL(file));
      }
    }
  }
  let tributes = loadTributes();
  tributes.unshift({from, msg, date, photos});
  saveTributes(tributes);
  renderAllTributes();
  document.getElementById('tributeForm').reset();
  setTimeout(() => { photos.forEach(ph=>{ if(ph.startsWith('blob:')) URL.revokeObjectURL(ph); });}, 6500);
};
// --- EDIT CARD ---
function startEditCard(idx,cardElem) {
  let tribs = loadTributes();
  let t = tribs[idx];
  cardElem.innerHTML = `<form class='edit-tribute-form w-full h-full flex flex-col items-center justify-between p-1' autocomplete="off">
    <input type="text" class="edit-input font-bold px-2 py-1 rounded-xl border border-purple-300 w-4/5 my-2 text-purple-500 text-lg text-center" maxlength="32" value="${escapeHtml(t.from)}">
    <textarea class="edit-textarea px-2 py-1 rounded-xl border border-purple-300 w-4/5 my-1 mb-2 text-gray-700 text-center resize-none" maxlength="230" rows="3">${escapeHtml(t.msg)}</textarea>
    <div class='flex justify-center flex-wrap gap-2 mb-1'>
      ${t.photos&&t.photos.map((ph,i)=>
        `<span class="relative rounded-lg">
          <img src="${ph}" class="inline-block w-16 h-16 object-cover rounded-lg border border-purple-200 shadow-md">
          <button title="Remove" type="button" class="remove-img absolute -top-2 -right-2 text-sm text-center w-6 h-6 leading-5 bg-white border border-pink-400 text-pink-500 rounded-full hover:bg-pink-500 hover:text-white shadow-sm" data-phidx="${i}"><i class="fa fa-times"></i></button>
        </span>`).join("")}
    </div>
    <label class="w-full text-purple-400 font-medium text-xs mb-1"><i class="fa fa-image"></i> Add more photo
      <input type="file" accept="image/*" class="edit-photo-uploader ml-1 mb-1" style="display:inline;" multiple>
    </label>
    <div class="edit-actions mt-2 w-full flex justify-center gap-2">
      <button type="submit" class="bg-violet-200 hover:bg-violet-300 text-indigo-700 font-semibold py-1 px-3 rounded-lg">Save</button>
      <button type="button" class="bg-pink-200 hover:bg-pink-300 text-pink-700 font-semibold py-1 px-3 rounded-lg cancel-edit-btn">Cancel</button>
    </div>
  </form>`;
  // Remove photo in edit mode
  cardElem.querySelectorAll('.remove-img').forEach(btn=>{
    btn.onclick = function(){
      let phidx = parseInt(btn.getAttribute('data-phidx'));
      t.photos.splice(phidx,1);
      startEditCard(idx,cardElem);
    }
  });
  // Add photo (up to 4 in total)
  cardElem.querySelector('.edit-photo-uploader').onchange = function(e){
    let files = Array.from(e.target.files);
    if(files.some(f=>t.photos.length<4 && f.type.startsWith('image/') && f.size<4e6)){
      files.slice(0,4-t.photos.length).forEach(f=>{
        let url = URL.createObjectURL(f);
        t.photos.push(url);
      });
      startEditCard(idx,cardElem); // rerender
    }
  }
  cardElem.querySelector('.cancel-edit-btn').onclick = function(){ renderAllTributes(false); }
  cardElem.querySelector('.edit-tribute-form').onsubmit = function(e){
    e.preventDefault();
    t.from = cardElem.querySelector('.edit-input').value.trim().slice(0,32)||"";
    t.msg = cardElem.querySelector('.edit-textarea').value.trim().slice(0,230)||"";
    saveTributes(tribs);
    renderAllTributes(false);
  }
}
// ----- FAN IMAGE EVENTS (expanding, modal) -----
function attachFanImgEvents() {
  document.querySelectorAll('.fan-img').forEach(img=>{
    img.onclick = function(e){
      e.stopPropagation();
      let src = img.getAttribute('src');
      showFanModal(src);
    }
    // Mobile: animate on scroll into view instead of hover
    img.classList.remove('expanded','fanImgAnim');
    // Using IntersectionObserver for mobile-friendly reveal
    if(window.fanObs) window.fanObs.disconnect();
    window.fanObs = new window.IntersectionObserver((ents)=>{
      ents.forEach(ent=>{
        if(ent.isIntersecting){
          ent.target.classList.add("fanImgAnim");
        }
      })
    },{threshold:.6});
    window.fanObs.observe(img);
  });
}
// --- MODAL ---
function showFanModal(src){
  let m = document.getElementById('fanModal');
  document.getElementById('fanModalImg').src = src;
  m.classList.remove('hidden');
  document.body.style.overflow='hidden';
}
document.getElementById('fanModalClose').onclick = function(){
  document.getElementById('fanModal').classList.add('hidden');
  document.body.style.overflow='';
}
document.getElementById('fanModal').onclick = function(e){
  if(e.target===this) document.getElementById('fanModalClose').click();
}
document.addEventListener('keydown', function(e){
  if(document.getElementById('fanModal').classList.contains('hidden')) return;
  if(e.key==='Escape') document.getElementById('fanModalClose').click();
});
// --- Animate on scroll for cards (mobile: no hover) ---
function applyScrollInAnimForCards() {
  if (!('IntersectionObserver' in window)) return;
  let obs = new window.IntersectionObserver((entries)=>{
    entries.forEach(ent=>{
      if(ent.isIntersecting){
        ent.target.classList.add('animate-in');
        obs.unobserve(ent.target);
      }
    });
  }, {threshold:0.26});
  document.querySelectorAll(".tribute-card").forEach(card=>{
    obs.observe(card);
  });
}
document.addEventListener("DOMContentLoaded", function() {
  renderAllTributes();
  setTimeout(applyScrollInAnimForCards, 400);
});
</script>
</body>
</html>

